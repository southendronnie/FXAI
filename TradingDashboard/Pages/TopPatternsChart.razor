@inject PatternService PatternService
@inject HighchartsInterop ChartInterop

<h3>Top Patterns Chart</h3>
<div id="@ChartId" class="chart-box"></div>

@code {
    private string ChartId => $"top-patterns-chart-{Guid.NewGuid():N}";

    protected override async Task OnInitializedAsync()
    {
        var stats = PatternService.GetLatestStats()
            .Where(s => s.TotalTrades >= 10)
            .OrderByDescending(s => s.NetPnL)
            .Take(10)
            .ToList();

        var chartOptions = new
        {
            chart = new { type = "column" },
            title = new { text = "Top Patterns by NetPnL" },
            xAxis = new
            {
                categories = stats.Select(s => $"{s.PatternId} ({s.StrategyId})").ToArray(),
                title = new { text = "Pattern / Strategy" }
            },
            yAxis = new
            {
                title = new { text = "NetPnL" }
            },
            series = new[]
            {
                new
                {
                    name = "NetPnL",
                    data = stats.Select(s => s.NetPnL).ToArray()
                }
            }
        };

        await ChartInterop.RenderChartAsync(ChartId, chartOptions);
    }
}